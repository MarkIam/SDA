{% extends "base.html"%}

{%block content%}
<div class="row">
    <!-- <div class="col-md-10 col-sm-12">
        <table class="table table-hover" >
            <thead>
                <tr>
                    <th> id</th>
                    <th> Фамилия </th>
                    <th> Имя </th>
                    <th> Почта </th>
                </tr>
            </thead>
            {% for skydiver in skydivers_list%}
            <tr> 
                <td> {{skydiver.id}} </td>
                <td> <a href="/skydiver/{{skydiver.id}}">{{skydiver.last_name}}</a></td>
                <td> {{skydiver.first_name}} </td>
                <td> {{skydiver.email }} </td>
            </tr>
            {%endfor%}
        </table >
    </div> -->
    <!-- <form action="" method="POST">
        <div class="mb-2">
            <label for="skydiverSelect" class="form-label">Клиент</label>
            <select id="skydiverSelect" class="form-select">
                {% for skydiver in skydivers_list%}
                <option value={{skydiver.id}}>{{skydiver.last_name}} {{skydiver.first_name}} </option>
                {%endfor%}
            </select>
        </div>
        <div class="mb-2">
            <label for="requestDate" class="form-label">Дата прыжка</label>
            <input id="requestDate" type="date" />
        </div>
    </form> -->
    <div class="col-3" id="liftsArea">
    </div>
    <div class="col-9" id="requestsArea">
    </div>
</div>
<script type="text/javascript">

    async function searchRequests(){
        let response = await fetch('http://127.0.0.1:8000/manifest/request/json')
        let data  = await response.json()

        let  ar = document.getElementById('requestsArea')
        ar.innerHTML='<h1>Заявки</h1><div class="accordion" id="accordionRequests">'
        let accordEl = document.getElementById('accordionRequests')
        let old_discipine = '-'
        let current_discipine = '-'
        let accordeonItem = undefined
        let accordeonBody = undefined

        for(let el of data){
            current_discipine = el.discipline_name
            if (current_discipine != old_discipine){
                accordeonItem = document.createElement('div')
                accordeonItem.innerHTML=
                `<div class="accordion-item">
                    <h2 class="accordion-header" id="heading` + el.discipline_short_name + `">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse` + el.discipline_short_name + 
                        `" aria-expanded="` + (old_discipine == '-' ? 'true' : 'false') + `" aria-controls="collapse` + el.discipline_short_name + `">
                            ` + current_discipine + `
                        </button>
                    </h2>
                    <div id="collapse`+ el.discipline_short_name +`" class="accordion-collapse collapse show" aria-labelledby="heading` + el.discipline_short_name + `" data-bs-parent="#accordionRequests">
                        <div class="accordion-body">
                            <ul id="list-group-` + el.discipline_short_name + `" class="list-group">
                            </ul>
                        </div>
                    </div>
                </div>`
                accordEl.appendChild(accordeonItem)
                accordeonBody = accordeonItem.getElementsByClassName('list-group')[0]

                old_discipine = current_discipine
            }
            skydiverElement = document.createElement('li')
            skydiverElement.className = 'list-group-item'
            skydiverElement.innerHTML= el.skydiver_name
            
            accordeonBody.appendChild(skydiverElement)
        }
            
        return false
    }

    async function searchLifts(){
        let response = await fetch('http://127.0.0.1:8000/manifest/lift/json')
        let data  = await response.json()

        let  ar = document.getElementById('liftsArea')
        ar.innerHTML='<h1>Подъемы</h1><ul id="liftsGroup" class="list-group"></ul>'
        let parent = document.getElementById('liftsGroup')

        for(let el of data){
            current_discipine = el.discipline_name

            skydiverElement = document.createElement('li')
            skydiverElement.className = 'list-group-item'
            skydiverElement.id = el.id
            skydiverElement.innerHTML= el.lift_date + ', ' + el.ord_number + ', ' + el.plane_reg_number

            parent.appendChild(skydiverElement)
        }
            
        return false
    }
    searchRequests();
    searchLifts();
</script>

{%endblock%}